<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>환율, 시차 계산기</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- SNS / 카카오톡 미리보기용 메타태그 -->
  <meta name="description" content="간편하게 환율,시차 계산하려면 여기를 눌러 확인하세요." />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="환율, 시차 계산기" />
  <meta property="og:description" content="간편하게 환율,시차 계산하려면 여기를 눌러 확인하세요." />
  <meta property="og:url" content="https://eumditravel-oss.github.io/Exchange/" />
  <meta property="og:image" content="https://eumditravel-oss.github.io/Exchange/preview.png" />
  <meta property="og:locale" content="ko_KR" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="환율, 시차 계산기" />
  <meta name="twitter:description" content="간편하게 환율,시차 계산하려면 여기를 눌러 확인하세요." />
  <meta name="twitter:image" content="https://eumditravel-oss.github.io/Exchange/preview.png" />

  <style>
    :root {
      --panel-bg: rgba(255, 255, 255, 0.78);
      --panel-inner-bg: rgba(255, 255, 255, 0.9);
      --border: rgba(209, 213, 219, 0.8);
      --accent: #2563eb;
      --accent-soft: rgba(37, 99, 235, 0.12);
      --text: #111827;
      --muted: #4b5563;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 16px 8px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text);
      background:
        radial-gradient(circle at top, rgba(59,130,246,0.35), transparent 55%),
        linear-gradient(to bottom, rgba(15, 23, 42, 0.4), rgba(15, 23, 42, 0.85)),
        url("plane-window.png") center/cover fixed no-repeat;
      min-height: 100vh;
    }

    .app {
      max-width: 1040px;
      margin: 0 auto;
      padding: 18px 20px 14px;
      background: var(--panel-bg);
      border-radius: 22px;
      border: 1px solid rgba(255, 255, 255, 0.6);
      box-shadow:
        0 16px 38px rgba(15, 23, 42, 0.32),
        0 0 0 1px rgba(255, 255, 255, 0.15);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      animation: appFadeIn 0.5s ease-out;
    }

    @keyframes appFadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    header {
      position: relative;
      z-index: 1;
    }

    /* 데스크탑 기본 크기 */
    h1 {
      font-size: 1.45rem;
      margin: 0 0 0.15rem;
      color: #111827;
    }

    /* 모바일 화면에서 더 작게 */
    @media (max-width: 720px) {
      h1 { font-size: 1.25rem; }
    }

    p.desc {
      margin: 0;
      color: #374151;
      font-size: 0.9rem;
    }

    /* 상단 탭만 배치 (선택방식은 패널 안으로 이동) */
    .top-bar {
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: flex-start;
    }

    .tabs {
      display: inline-flex;
      padding: 2px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.8);
      box-shadow: 0 1px 5px rgba(15, 23, 42, 0.18);
      gap: 4px;
    }

    .tab-button {
      border: none;
      background: transparent;
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 0.86rem;
      cursor: pointer;
      color: #6b7280;
      white-space: nowrap;
      transition: background 0.18s ease, color 0.18s ease, transform 0.12s ease;
    }

    .tab-button:hover {
      background: rgba(15,23,42,0.05);
      transform: translateY(-1px);
    }

    .tab-button.active {
      background: linear-gradient(135deg, #111827, #2563eb);
      color: #f9fafb;
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.35);
    }

    .view {
      margin-top: 12px;
    }

    .layout {
      position: relative;
      z-index: 1;
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
    }

    .panel {
      flex: 1 1 320px;
      min-width: 0;
      border-radius: 16px;
      border: 1px solid var(--border);
      padding: 14px 16px 16px;
      background: var(--panel-inner-bg);
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.18);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
      transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(37,99,235,0.08), transparent 55%);
      pointer-events: none;
      opacity: 0.9;
    }

    .panel:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.24);
      border-color: rgba(129, 140, 248, 0.9);
    }

    .panel h2 {
      font-size: 1.05rem;
      margin: 0 0 0.35rem;
      position: relative;
      z-index: 1;
    }

    label {
      display: block;
      margin-top: 0.9rem;
      font-weight: 600;
      font-size: 0.88rem;
      position: relative;
      z-index: 1;
    }

    input, select, textarea {
      width: 100%;
      padding: 7px 9px;
      margin-top: 0.35rem;
      border: 1px solid rgba(148, 163, 184, 0.9);
      border-radius: 8px;
      font-size: 0.9rem;
      background: rgba(255, 255, 255, 0.94);
      position: relative;
      z-index: 1;
    }

    /* iPhone에서 input 클릭 시 자동 확대 방지 */
    @media (max-width: 720px) {
      input, select, textarea {
        font-size: 16px !important;
      }
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
    }

    .help {
      font-size: 0.78rem;
      color: var(--muted);
      margin-top: 0.15rem;
      position: relative;
      z-index: 1;
    }

    .small-label {
      margin-top: 0.35rem;
      font-size: 0.78rem;
      color: var(--muted);
      position: relative;
      z-index: 1;
    }

    /* 패널 상단 우측 컨트롤 (선택 방식) */
    .panel-top-controls {
      position: relative;
      z-index: 2;
      display: flex;
      justify-content: flex-end;
      margin-bottom: 4px;
    }

    .mode-toggle {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 1px 4px rgba(15, 23, 42, 0.12);
      font-size: 0.78rem;
      color: #4b5563;
    }

    .mode-label {
      font-weight: 500;
    }

    .mode-btn {
      border: none;
      background: transparent;
      padding: 4px 9px;
      border-radius: 999px;
      font-size: 0.78rem;
      cursor: pointer;
      color: #6b7280;
      white-space: nowrap;
      transition: background 0.18s ease, color 0.18s ease, transform 0.12s ease;
    }

    .mode-btn:hover {
      background: rgba(15,23,42,0.05);
    }

    .mode-btn.active {
      background: #111827;
      color: #f9fafb;
    }

    .suggestions {
      position: relative;
      z-index: 5;
    }

    .suggestions-list {
      position: absolute;
      z-index: 10;
      top: 100%;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.98);
      border: 1px solid rgba(209, 213, 219, 0.9);
      border-top: none;
      max-height: 200px;
      overflow-y: auto;
      font-size: 0.82rem;
      border-radius: 0 0 8px 8px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.35);
    }

    .suggestion-item {
      padding: 6px 9px;
      cursor: pointer;
    }

    .suggestion-item:hover {
      background: var(--accent-soft);
    }

    .rate-info {
      margin-top: 0.45rem;
      font-size: 0.78rem;
      color: var(--muted);
      position: relative;
      z-index: 1;
    }

    .error {
      margin-top: 0.5rem;
      color: #b91c1c;
      font-size: 0.8rem;
      position: relative;
      z-index: 1;
    }

    .ok {
      margin-top: 0.45rem;
      color: #2563eb;
      font-size: 0.8rem;
      position: relative;
      z-index: 1;
    }

    .calc-summary {
      margin-top: 0.7rem;
      font-size: 0.9rem;
      position: relative;
      z-index: 1;
    }

    .calc-summary div {
      margin-top: 0.25rem;
    }

    .calc-main {
      font-weight: 600;
    }

    .section-divider {
      margin-top: 0.9rem;
      padding-top: 0.7rem;
      border-top: 1px dashed rgba(148, 163, 184, 0.8);
      position: relative;
      z-index: 1;
    }

    .sub-heading {
      margin: 0 0 0.3rem;
      font-size: 0.9rem;
      font-weight: 600;
    }

    footer {
      position: relative;
      z-index: 1;
      margin-top: 12px;
      font-size: 0.78rem;
      color: #e5e7eb;
      text-align: center;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.35);
    }

    footer a {
      color: #bfdbfe;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* PC/모바일용 설명 분리 */
    .only-desktop { display: block; }
    .only-mobile  { display: none; }

    @media (max-width: 720px) {
      .panel { flex: 1 1 100%; }

      .top-bar {
        flex-wrap: nowrap;
        align-items: center;
        justify-content: flex-start;
        gap: 4px;
      }

      .tab-button {
        padding: 4px 10px;
        font-size: 0.8rem;
      }

      .mode-toggle {
        font-size: 0.7rem;
        padding: 2px 6px;
        gap: 4px;
      }

      .mode-label {
        font-size: 0.7rem;
      }

      .mode-btn {
        padding: 3px 6px;
        font-size: 0.7rem;
      }

      .only-desktop { display: none; }
      .only-mobile  { display: block; }
    }

    /* 선택 방식에 따른 표시 제어 */
    body[data-pick-mode="search"] .select-mode { display: none; }
    body[data-pick-mode="search"] .search-mode { display: block; }

    body[data-pick-mode="select"] .select-mode { display: block; }
    body[data-pick-mode="select"] .search-mode { display: none; }

    /* 텍스트 합산식용 + / - 키패드 + 안내문 한 줄 */
    .calc-keypad {
      margin-top: 6px;
      display: inline-flex;
      gap: 6px;
    }

    .calc-key {
      min-width: 32px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: #f9fafb;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.12s ease, transform 0.12s ease;
    }

    .calc-key:hover {
      background: #eef2ff;
    }

    .calc-key:active {
      background: #e5e7eb;
      transform: translateY(1px);
    }

    .calc-keys-wrapper {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 6px;
      white-space: nowrap;  /* 줄바꿈 방지 */
      position: relative;
      z-index: 1;
    }

    .calc-hint {
      font-size: 0.78rem;
      color: #6b7280;
    }

    /* 일정 관리용 스타일 */
    .plan-toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 0.6rem;
      position: relative;
      z-index: 1;
    }

    .btn {
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: #f9fafb;
      font-size: 0.8rem;
      cursor: pointer;
      transition: background 0.15s ease, transform 0.12s ease, box-shadow 0.15s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      color: #f9fafb;
      border-color: transparent;
      box-shadow: 0 2px 6px rgba(37, 99, 235, 0.4);
    }

    .btn:hover {
      background: #eef2ff;
      transform: translateY(-1px);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #1d4ed8, #4338ca);
    }

    .day-tabs {
      margin-top: 0.6rem;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      position: relative;
      z-index: 1;
    }

    .day-tab {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: #f9fafb;
      font-size: 0.8rem;
      cursor: pointer;
      white-space: nowrap;
      transition: background 0.12s ease, color 0.12s ease, transform 0.12s ease;
    }

    .day-tab.active {
      background: #111827;
      color: #f9fafb;
      transform: translateY(-1px);
    }

    .plan-textarea {
      margin-top: 0.6rem;
      min-height: 120px;
      resize: vertical;
    }

    .plan-export {
      margin-top: 0.6rem;
      font-size: 0.8rem;
      position: relative;
      z-index: 1;
    }

    .plan-export textarea {
      margin-top: 0.3rem;
      min-height: 80px;
      font-size: 0.8rem;
    }

    /* 일정 관리 탭에서는 선택 방식 숨김 */
    .view-plan .panel-top-controls {
      display: none;
    }
  </style>
</head>
<body data-pick-mode="search">
  <div class="app">
    <header>
      <h1>환율, 시차 계산기</h1>
      <p class="desc">여행·송금 전에 환율, 환전금액 합산, 시차, 일정까지 한 번에 확인하기.</p>

      <!-- 상단: 탭만 배치 -->
      <div class="top-bar">
        <div class="tabs">
          <button class="tab-button active" data-view="exchange">환율 계산</button>
          <button class="tab-button" data-view="time">시차 검색</button>
          <button class="tab-button" data-view="plan">일정 관리</button>
        </div>
      </div>
    </header>

    <!-- ===== 환율 계산 뷰 ===== -->
    <div class="view view-exchange">
      <div class="layout">
        <section class="panel">
          <div class="panel-top-controls">
            <div class="mode-toggle">
              <span class="mode-label">선택 방식</span>
              <button class="mode-btn active" data-mode="search">검색형</button>
              <button class="mode-btn" data-mode="select">드롭다운형</button>
            </div>
          </div>

          <h2>환율 계산</h2>

          <!-- 기준 통화 -->
          <label for="fromSearch">기준 통화 (From)</label>
          <div class="search-mode">
            <div class="suggestions">
              <input id="fromSearch" type="text" placeholder="예: hkd, 홍콩, usd, 미국…" autocomplete="off" />
              <div id="fromSuggestions" class="suggestions-list" style="display:none;"></div>
            </div>
          </div>
          <div class="select-mode">
            <select id="fromSelect"></select>
          </div>
          <div class="small-label" id="fromSelectedLabel">선택된 기준 통화: 홍콩 달러 (HKD)</div>

          <!-- 변환 통화 -->
          <label for="toSearch" style="margin-top:0.8rem;">변환 통화 (To)</label>
          <div class="search-mode">
            <div class="suggestions">
              <input id="toSearch" type="text" placeholder="예: krw, 원, usd, eur…" autocomplete="off" />
              <div id="toSuggestions" class="suggestions-list" style="display:none;"></div>
            </div>
          </div>
          <div class="select-mode">
            <select id="toSelect"></select>
          </div>
          <div class="small-label" id="toSelectedLabel">선택된 변환 통화: 대한민국 원 (KRW)</div>

          <!-- 환율 정보 -->
          <div class="rate-info" id="rateInfo"></div>
          <div class="error" id="mainError"></div>
          <div class="ok" id="mainInfo"></div>

          <!-- 텍스트 합산식 섹션 -->
          <div class="section-divider">
            <p class="sub-heading">텍스트 합산식 계산</p>
            <p class="help only-desktop">
              예: <code>10+50-3</code> 처럼 계산하면 총 합의 환전 값 확인 가능.
            </p>
            <p class="help only-mobile">
              예: <code>10+50-3</code> 처럼 입력하면 합계, 환전 값을 확인가능.
            </p>

            <label for="calcExpr" style="margin-top:0.5rem;">합산할 식 (기준 통화 기준)</label>
            <input
              id="calcExpr"
              type="text"
              inputmode="numeric"
              pattern="[0-9+\\-\\s.,]*"
              placeholder="예: 10+50-3"
            />

            <!-- + / - 버튼 + 안내문 한 줄 -->
            <div class="calc-keys-wrapper">
              <div class="calc-keypad">
                <button type="button" class="calc-key" data-op="+">+</button>
                <button type="button" class="calc-key" data-op="-">−</button>
              </div>
              <span class="calc-hint">(+,-를 눌러 합산 또는 빼기 가능합니다.)</span>
            </div>

            <div class="calc-summary">
              <div class="calc-main">
                합계: <span id="calcSum">0</span> <span id="calcSumCurrency">HKD</span>
              </div>
              <div>
                환전 금액: <span id="calcConverted">-</span>
              </div>
              <div class="help">
                * 여기서 사용하는 통화는 위에 선택된 <b>통화</b>와 동일합니다.
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- ===== 시차 검색 뷰 ===== -->
    <div class="view view-time" style="display:none;">
      <div class="layout">
        <section class="panel">
          <div class="panel-top-controls">
            <div class="mode-toggle">
              <span class="mode-label">선택 방식</span>
              <button class="mode-btn active" data-mode="search">검색형</button>
              <button class="mode-btn" data-mode="select">드롭다운형</button>
            </div>
          </div>

          <h2>시차 검색</h2>

          <p class="help only-desktop">
            한국(서울) 기준으로 선택한 국가의 현재 시간과 시차를 확인할 수 있습니다.
          </p>
          <p class="help only-mobile">
            한국 기준 현재 시간과 선택한 나라의 시간, 시차를 한 번에 보여줍니다.
          </p>

          <label for="timeSearch">나라 / 통화 검색</label>

          <div class="search-mode">
            <div class="suggestions">
              <input id="timeSearch" type="text" placeholder="예: 미국, 홍콩, 일본, usd…" autocomplete="off" />
              <div id="timeSuggestions" class="suggestions-list" style="display:none;"></div>
            </div>
          </div>
          <div class="select-mode">
            <select id="timeSelect"></select>
          </div>

          <div class="small-label" id="timeSelectedLabel">
            선택된 국가: 홍콩 (HKD, Asia/Hong_Kong)
          </div>

          <div class="calc-summary" style="margin-top: 0.9rem;">
            <div id="timeKorea" class="calc-main"></div>
            <div id="timeTarget" style="margin-top:0.35rem;"></div>
            <div id="timeDiff" class="help" style="margin-top:0.7rem;"></div>
          </div>
        </section>
      </div>
    </div>

    <!-- ===== 일정 관리 뷰 ===== -->
    <div class="view view-plan" style="display:none;">
      <div class="layout">
        <section class="panel">
          <h2>일정 관리</h2>

          <p class="help">
            여행 일자를 Day 단위로 나누어 메모하고, 텍스트로 내보내거나 다시 불러올 수 있습니다.
          </p>

          <div class="plan-toolbar">
            <button type="button" class="btn btn-primary" id="addDayBtn">Day 추가</button>
            <button type="button" class="btn" id="removeDayBtn">현재 Day 삭제</button>
            <button type="button" class="btn" id="renameDayBtn">현재 Day 이름 변경</button>
          </div>

          <div class="day-tabs" id="dayTabs"></div>

          <label for="dayContent" style="margin-top:0.7rem;">선택된 Day 메모</label>
          <textarea id="dayContent" class="plan-textarea" placeholder="예: 아침 - 호텔 조식 / 오후 - 쇼핑 / 저녁 - 야시장"></textarea>

          <div class="plan-export">
            <button type="button" class="btn" id="exportTextBtn">텍스트로 내보내기</button>
            <button type="button" class="btn" id="importTextBtn">텍스트 불러오기</button>
            <div class="help">
              * 내보낸 내용을 복사해서 메모앱이나 텍스트 파일로 보관하고, 나중에 다시 붙여넣어 불러올 수 있습니다.
            </div>
            <textarea id="planTextArea" placeholder="[Day.1] 형식으로 내보내기/불러오기용 텍스트가 표시됩니다."></textarea>
          </div>
        </section>
      </div>
    </div>

    <footer>
      GitHub Pages + JavaScript 예제 · 환율 데이터 제공 :
      <a href="https://www.exchangerate-api.com" target="_blank" rel="noopener noreferrer">ExchangeRate-API</a>
    </footer>
  </div>

  <script>
    // ===== 통화 + 시간대 목록 (countryKo 포함) =====
    const currencies = [
      { code: "USD", nameKo: "미국 달러",     countryKo: "미국",       aliases: ["usd","dollar","달러","미국","usa"], timeZone: "America/New_York" },
      { code: "EUR", nameKo: "유로",          countryKo: "유로존",     aliases: ["eur","euro","유로","유럽"],        timeZone: "Europe/Berlin" },
      { code: "KRW", nameKo: "대한민국 원",   countryKo: "대한민국",   aliases: ["krw","원","한국","대한민국","won","seoul"], timeZone: "Asia/Seoul" },
      { code: "HKD", nameKo: "홍콩 달러",     countryKo: "홍콩",       aliases: ["hkd","홍콩","hongkong","hong kong"], timeZone: "Asia/Hong_Kong" },
      { code: "JPY", nameKo: "일본 엔",       countryKo: "일본",       aliases: ["jpy","엔","엔화","일본","japan","yen"], timeZone: "Asia/Tokyo" },
      { code: "CNY", nameKo: "중국 위안",     countryKo: "중국",       aliases: ["cny","위안","rmb","중국","china","yuan"], timeZone: "Asia/Shanghai" },
      { code: "GBP", nameKo: "영국 파운드",   countryKo: "영국",       aliases: ["gbp","파운드","영국","uk","london"], timeZone: "Europe/London" },
      { code: "AUD", nameKo: "호주 달러",     countryKo: "호주",       aliases: ["aud","호주","australia","sydney"], timeZone: "Australia/Sydney" },
      { code: "CAD", nameKo: "캐나다 달러",   countryKo: "캐나다",     aliases: ["cad","캐나다","canada","toronto"], timeZone: "America/Toronto" },
      { code: "CHF", nameKo: "스위스 프랑",   countryKo: "스위스",     aliases: ["chf","스위스","swiss","franc"], timeZone: "Europe/Zurich" },
      { code: "SGD", nameKo: "싱가포르 달러", countryKo: "싱가포르",   aliases: ["sgd","싱가포르","singapore"], timeZone: "Asia/Singapore" },
      { code: "THB", nameKo: "태국 바트",     countryKo: "태국",       aliases: ["thb","태국","방콕","thailand"], timeZone: "Asia/Bangkok" },
      { code: "TWD", nameKo: "대만 달러",     countryKo: "대만",       aliases: ["twd","대만","taiwan"], timeZone: "Asia/Taipei" },
      { code: "NZD", nameKo: "뉴질랜드 달러", countryKo: "뉴질랜드",   aliases: ["nzd","뉴질랜드","new zealand"], timeZone: "Pacific/Auckland" },
      { code: "PHP", nameKo: "필리핀 페소",   countryKo: "필리핀",     aliases: ["php","필리핀","philippines"], timeZone: "Asia/Manila" },
      { code: "MYR", nameKo: "말레이시아 링깃", countryKo: "말레이시아", aliases: ["myr","말레이시아","malaysia"], timeZone: "Asia/Kuala_Lumpur" },
      { code: "IDR", nameKo: "인도네시아 루피아", countryKo: "인도네시아", aliases: ["idr","인도네시아","indonesia"], timeZone: "Asia/Jakarta" },
      { code: "VND", nameKo: "베트남 동",     countryKo: "베트남",     aliases: ["vnd","베트남","vietnam","동"], timeZone: "Asia/Ho_Chi_Minh" }
    ];

    // ===== DOM: 환율 부분 =====
    const fromSearchInput = document.getElementById("fromSearch");
    const toSearchInput   = document.getElementById("toSearch");
    const fromSugBox      = document.getElementById("fromSuggestions");
    const toSugBox        = document.getElementById("toSuggestions");
    const fromLabel       = document.getElementById("fromSelectedLabel");
    const toLabel         = document.getElementById("toSelectedLabel");

    const fromSelect      = document.getElementById("fromSelect");
    const toSelect        = document.getElementById("toSelect");

    const rateInfoEl      = document.getElementById("rateInfo");
    const mainErrorEl     = document.getElementById("mainError");
    const mainInfoEl      = document.getElementById("mainInfo");

    const calcExprInput   = document.getElementById("calcExpr");
    const calcSumEl       = document.getElementById("calcSum");
    const calcSumCurrencyEl = document.getElementById("calcSumCurrency");
    const calcConvertedEl = document.getElementById("calcConverted");

    const calcKeyButtons  = document.querySelectorAll(".calc-key");

    // ===== DOM: 시차 부분 =====
    const timeSearchInput = document.getElementById("timeSearch");
    const timeSugBox      = document.getElementById("timeSuggestions");
    const timeSelect      = document.getElementById("timeSelect");
    const timeLabel       = document.getElementById("timeSelectedLabel");
    const timeKoreaEl     = document.getElementById("timeKorea");
    const timeTargetEl    = document.getElementById("timeTarget");
    const timeDiffEl      = document.getElementById("timeDiff");

    // ===== DOM: 일정 관리 부분 =====
    const dayTabsEl       = document.getElementById("dayTabs");
    const dayContentEl    = document.getElementById("dayContent");
    const addDayBtn       = document.getElementById("addDayBtn");
    const removeDayBtn    = document.getElementById("removeDayBtn");
    const renameDayBtn    = document.getElementById("renameDayBtn");
    const exportTextBtn   = document.getElementById("exportTextBtn");
    const importTextBtn   = document.getElementById("importTextBtn");
    const planTextArea    = document.getElementById("planTextArea");

    // ===== 탭 =====
    const tabButtons   = document.querySelectorAll(".tab-button");
    const viewExchange = document.querySelector(".view-exchange");
    const viewTime     = document.querySelector(".view-time");
    const viewPlan     = document.querySelector(".view-plan");

    tabButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        tabButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        const v = btn.dataset.view;
        if (v === "exchange") {
          viewExchange.style.display = "block";
          viewTime.style.display = "none";
          viewPlan.style.display = "none";
        } else if (v === "time") {
          viewExchange.style.display = "none";
          viewTime.style.display = "block";
          viewPlan.style.display = "none";
          updateTimeInfo();
        } else {
          viewExchange.style.display = "none";
          viewTime.style.display = "none";
          viewPlan.style.display = "block";
        }
      });
    });

    // ===== 선택 방식 토글 (검색형 / 드롭다운형) =====
    const modeButtons = document.querySelectorAll(".mode-btn");

    function setPickMode(mode) {
      document.body.setAttribute("data-pick-mode", mode);
      modeButtons.forEach(b => {
        if (b.dataset.mode === mode) b.classList.add("active");
        else b.classList.remove("active");
      });
    }

    modeButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const mode = btn.dataset.mode;
        setPickMode(mode);
      });
    });

    // ===== 상태 =====
    let baseCode   = "HKD"; // 기준 통화
    let targetCode = "KRW"; // 변환 통화
    let currentRate = null; // base → target
    let lastUpdateText = "";

    let timeTargetCode = "HKD"; // 시차 조회 대상

    // 일정 관리용 상태
    let scheduleData = [];
    let currentDayId = null;
    const STORAGE_KEY = "eumdi_exchange_schedule_v1";

    // ===== 공통 유틸 =====
    function findCurrency(code) {
      return currencies.find(c => c.code === code);
    }

    function formatCurrencyLabel(code) {
      const c = findCurrency(code);
      if (!c) return code;
      return `${c.nameKo} (${c.code})`;
    }

    function optionLabel(c) {
      return `${c.code} - ${c.nameKo}`;
    }

    function populateSelect(selectEl) {
      selectEl.innerHTML = "";
      currencies.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c.code;
        opt.textContent = optionLabel(c);
        selectEl.appendChild(opt);
      });
    }

    function setSelectValue(selectEl, code) {
      const options = Array.from(selectEl.options);
      const found = options.find(o => o.value === code);
      if (found) selectEl.value = code;
    }

    function searchCurrencies(query) {
      const q = query.trim().toLowerCase();
      if (!q) return currencies.slice(0, 10);
      return currencies.filter(c => {
        const combined = (c.code + " " + c.nameKo + " " + c.aliases.join(" ")).toLowerCase();
        return combined.includes(q);
      }).slice(0, 10);
    }

    function setupSearchBox(inputEl, listEl, onSelect) {
      function renderList(items) {
        if (!items.length) {
          listEl.style.display = "none";
          listEl.innerHTML = "";
          return;
        }
        listEl.innerHTML = "";
        for (const c of items) {
          const div = document.createElement("div");
          div.className = "suggestion-item";
          div.textContent = optionLabel(c);
          div.addEventListener("mousedown", (e) => {
            e.preventDefault();
            inputEl.value = optionLabel(c);
            listEl.style.display = "none";
            onSelect(c.code);
          });
          listEl.appendChild(div);
        }
        listEl.style.display = "block";
      }

      inputEl.addEventListener("input", () => {
        renderList(searchCurrencies(inputEl.value));
      });

      inputEl.addEventListener("focus", () => {
        // 클릭하면 기존 텍스트 지우고, 추천 목록 표시
        inputEl.value = "";
        renderList(searchCurrencies(""));
      });

      inputEl.addEventListener("blur", () => {
        setTimeout(() => { listEl.style.display = "none"; }, 150);
      });

      inputEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          const items = searchCurrencies(inputEl.value);
          if (items.length > 0) {
            const c = items[0];
            inputEl.value = optionLabel(c);
            listEl.style.display = "none";
            onSelect(c.code);
          }
        }
      });
    }

    // ===== 환율 API (open.er-api.com) =====
    async function fetchRate() {
      mainErrorEl.textContent = "";
      mainInfoEl.textContent = "";
      rateInfoEl.textContent = "";
      calcConvertedEl.textContent = "-";
      currentRate = null;

      try {
        const url = `https://open.er-api.com/v6/latest/${encodeURIComponent(baseCode)}`;
        const res = await fetch(url);
        if (!res.ok) {
          throw new Error("HTTP 오류: " + res.status);
        }
        const data = await res.json();
        if (data.result !== "success") {
          throw new Error("API 오류: " + (data["error-type"] || "unknown"));
        }

        const rate = data.rates?.[targetCode];
        if (typeof rate !== "number") {
          throw new Error("해당 통화 쌍의 환율을 찾을 수 없습니다.");
        }

        currentRate = rate;
        lastUpdateText = data.time_last_update_utc || "";

        // 줄바꿈 안 되는 공백(\u00a0) 사용
        const baseStr = `1\u00a0${baseCode}`;
        const rateStr = `${rate.toLocaleString(undefined, { maximumFractionDigits: 4 })}\u00a0${targetCode}`;

        rateInfoEl.textContent =
          `${lastUpdateText || "최근"} 기준 ${baseStr} ≈ ${rateStr}`;
        mainInfoEl.textContent = "환율 정보를 정상적으로 불러왔습니다.";
        updateCalcResult();
      } catch (err) {
        console.error(err);
        mainErrorEl.textContent = "환율 정보를 불러오지 못했습니다. 잠시 후 다시 시도해주세요.";
      }
    }

    // "1000+5000-300" 같은 식 파싱
    function parseExpression(raw) {
      const str = raw.replace(/,/g, "");
      if (!str.trim()) return 0;
      const tokens = str.match(/[+\-]?\s*\d+(?:\.\d+)?/g);
      if (!tokens) return NaN;
      let sum = 0;
      for (const t of tokens) {
        const num = Number(t.replace(/\s+/g, ""));
        if (!Number.isFinite(num)) return NaN;
        sum += num;
      }
      return sum;
    }

    function updateCalcResult() {
      const expr = calcExprInput.value;
      const sum = parseExpression(expr);
      if (Number.isNaN(sum)) {
        calcSumEl.textContent = "입력 오류";
        calcConvertedEl.textContent = "-";
        return;
      }
      calcSumEl.textContent = sum.toLocaleString();
      calcSumCurrencyEl.textContent = baseCode;

      if (!currentRate) {
        calcConvertedEl.textContent = "환율 정보를 먼저 불러와야 합니다.";
        return;
      }
      const converted = sum * currentRate;
      calcConvertedEl.textContent =
        `${converted.toLocaleString(undefined, { maximumFractionDigits: 2 })} ${targetCode}`;
    }

    function setBase(code) {
      baseCode = code;
      fromLabel.textContent = `선택된 기준 통화: ${formatCurrencyLabel(code)}`;
      calcSumCurrencyEl.textContent = baseCode;
      setSelectValue(fromSelect, code);
      fetchRate();
    }

    function setTarget(code) {
      targetCode = code;
      toLabel.textContent = `선택된 변환 통화: ${formatCurrencyLabel(code)}`;
      setSelectValue(toSelect, code);
      fetchRate();
    }

    // + / - 버튼 클릭 시 입력창에 추가
    calcKeyButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const op = btn.dataset.op;
        const input = calcExprInput;
        const start = input.selectionStart ?? input.value.length;
        const end   = input.selectionEnd ?? input.value.length;
        const before = input.value.slice(0, start);
        const after  = input.value.slice(end);

        input.value = before + op + after;

        const newPos = start + op.length;
        input.focus();
        input.setSelectionRange(newPos, newPos);

        updateCalcResult();
      });
    });

    // 검색 박스 세팅
    setupSearchBox(fromSearchInput, fromSugBox, setBase);
    setupSearchBox(toSearchInput, toSugBox, setTarget);

    // select 박스 세팅
    populateSelect(fromSelect);
    populateSelect(toSelect);

    fromSelect.addEventListener("change", () => setBase(fromSelect.value));
    toSelect.addEventListener("change", () => setTarget(toSelect.value));

    // 초기 값 설정 (환율)
    fromSearchInput.value = optionLabel(findCurrency("HKD"));
    toSearchInput.value   = optionLabel(findCurrency("KRW"));
    fromLabel.textContent = "선택된 기준 통화: 홍콩 달러 (HKD)";
    toLabel.textContent   = "선택된 변환 통화: 대한민국 원 (KRW)";
    calcSumCurrencyEl.textContent = baseCode;
    setSelectValue(fromSelect, "HKD");
    setSelectValue(toSelect, "KRW");

    calcExprInput.addEventListener("input", updateCalcResult);

    // ===== 시차 계산 =====
    function formatLocalTime(date, timeZone) {
      return new Intl.DateTimeFormat("ko-KR", {
        timeZone,
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        weekday: "short",
        hour: "2-digit",
        minute: "2-digit"
      }).format(date);
    }

    function getOffsetMinutes(timeZone, date) {
      const fmt = new Intl.DateTimeFormat("en-US", {
        timeZone,
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
        hour12: false
      });
      const parts = fmt.formatToParts(date);
      const map = {};
      for (const p of parts) map[p.type] = p.value;
      const asUTC = Date.UTC(
        Number(map.year),
        Number(map.month) - 1,
        Number(map.day),
        Number(map.hour),
        Number(map.minute),
        Number(map.second)
      );
      const diffMs = asUTC - date.getTime();
      return diffMs / 60000; // 분
    }

    function describeDiff(diffMin, countryName) {
      if (Math.abs(diffMin) < 0.5) {
        return `${countryName}은(는) 한국과 시차가 없습니다.`;
      }
      const ahead = diffMin > 0;
      const abs = Math.round(Math.abs(diffMin));
      const hours = Math.floor(abs / 60);
      const minutes = abs % 60;
      let parts = [];
      if (hours) parts.push(`${hours}시간`);
      if (minutes) parts.push(`${minutes}분`);
      const span = parts.join(" ");
      return `${countryName}은(는) 한국보다 ${span} ${ahead ? "빠릅니다" : "느립니다"}.`;
    }

    function updateTimeInfo() {
      const baseTZ = "Asia/Seoul";
      const now = new Date();

      const baseTimeStr = formatLocalTime(now, baseTZ);
      timeKoreaEl.textContent = `한국 시간: ${baseTimeStr}`;

      const c = findCurrency(timeTargetCode);
      if (!c || !c.timeZone) {
        timeTargetEl.textContent = "선택한 국가의 시간대를 찾을 수 없습니다.";
        timeDiffEl.textContent = "";
        return;
      }

      const country = c.countryKo || c.nameKo;
      const targetTimeStr = formatLocalTime(now, c.timeZone);
      timeTargetEl.textContent = `${country} 시간: ${targetTimeStr}`;

      const baseOffset = getOffsetMinutes(baseTZ, now);
      const targetOffset = getOffsetMinutes(c.timeZone, now);
      const diffMin = targetOffset - baseOffset;
      timeDiffEl.textContent = describeDiff(diffMin, country);
    }

    function setTimeTarget(code) {
      timeTargetCode = code;
      const c = findCurrency(code);
      if (c) {
        const country = c.countryKo || c.nameKo;
        timeLabel.textContent =
          `선택된 국가: ${country} (${c.code}, ${c.timeZone || "시간대 정보 없음"})`;
      } else {
        timeLabel.textContent = `선택된 국가 코드: ${code}`;
      }
      setSelectValue(timeSelect, code);
      updateTimeInfo();
    }

    setupSearchBox(timeSearchInput, timeSugBox, setTimeTarget);
    populateSelect(timeSelect);
    timeSelect.addEventListener("change", () => setTimeTarget(timeSelect.value));

    // 초기 값 설정 (시차: 홍콩)
    timeSearchInput.value = optionLabel(findCurrency("HKD"));
    setSelectValue(timeSelect, "HKD");
    setTimeTarget("HKD");

    // ===== 일정 관리 기능 =====
    function saveSchedule() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(scheduleData));
      } catch (e) {
        console.warn("localStorage 저장 실패", e);
      }
    }

    function loadSchedule() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
          scheduleData = [
            { id: "day1", title: "Day.1", content: "" }
          ];
          currentDayId = "day1";
          return;
        }
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed) && parsed.length > 0) {
          scheduleData = parsed;
          currentDayId = parsed[0].id;
        } else {
          scheduleData = [
            { id: "day1", title: "Day.1", content: "" }
          ];
          currentDayId = "day1";
        }
      } catch (e) {
        console.warn("localStorage 로드 실패", e);
        scheduleData = [
          { id: "day1", title: "Day.1", content: "" }
        ];
        currentDayId = "day1";
      }
    }

    function renderDayTabs() {
      dayTabsEl.innerHTML = "";
      scheduleData.forEach(day => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "day-tab" + (day.id === currentDayId ? " active" : "");
        btn.textContent = day.title;
        btn.addEventListener("click", () => {
          saveCurrentDayContent();
          currentDayId = day.id;
          updateDayContent();
          renderDayTabs();
        });
        dayTabsEl.appendChild(btn);
      });
    }

    function getCurrentDay() {
      return scheduleData.find(d => d.id === currentDayId);
    }

    function updateDayContent() {
      const day = getCurrentDay();
      if (!day) {
        dayContentEl.value = "";
        return;
      }
      dayContentEl.value = day.content || "";
    }

    function saveCurrentDayContent() {
      const day = getCurrentDay();
      if (!day) return;
      day.content = dayContentEl.value;
      saveSchedule();
    }

    addDayBtn.addEventListener("click", () => {
      saveCurrentDayContent();
      const index = scheduleData.length + 1;
      const newId = "day" + index;
      const newTitle = "Day." + index;
      scheduleData.push({ id: newId, title: newTitle, content: "" });
      currentDayId = newId;
      renderDayTabs();
      updateDayContent();
      saveSchedule();
    });

    removeDayBtn.addEventListener("click", () => {
      if (!currentDayId) return;
      if (scheduleData.length === 1) {
        alert("마지막 Day는 삭제할 수 없습니다.");
        return;
      }
      if (!confirm("현재 Day를 삭제하시겠습니까?")) return;
      scheduleData = scheduleData.filter(d => d.id !== currentDayId);
      currentDayId = scheduleData[0]?.id || null;
      renderDayTabs();
      updateDayContent();
      saveSchedule();
    });

    renameDayBtn.addEventListener("click", () => {
      const day = getCurrentDay();
      if (!day) return;
      const next = prompt("새로운 Day 이름을 입력하세요.", day.title);
      if (!next) return;
      day.title = next;
      renderDayTabs();
      saveSchedule();
    });

    dayContentEl.addEventListener("input", () => {
      saveCurrentDayContent();
    });

    // 텍스트 내보내기: [Day.x] 형태로 출력
    function exportScheduleToText() {
      saveCurrentDayContent();
      const lines = [];
      scheduleData.forEach(day => {
        lines.push(`[${day.title}]`);
        if (day.content) {
          const contentLines = day.content.split(/\r?\n/);
          contentLines.forEach(line => lines.push(line));
        }
        lines.push(""); // Day 사이 빈 줄
      });
      planTextArea.value = lines.join("\n");
    }

    function importScheduleFromText() {
      const raw = planTextArea.value;
      if (!raw.trim()) {
        alert("불러올 텍스트가 없습니다.");
        return;
      }
      const lines = raw.split(/\r?\n/);
      const newData = [];
      let current = null;

      lines.forEach(line => {
        const m = line.match(/^\s*\[(.+?)\]\s*$/);
        if (m) {
          if (current) {
            newData.push(current);
          }
          const title = m[1].trim();
          const id = "day" + (newData.length + 1);
          current = { id, title, content: "" };
        } else {
          if (!current) return;
          if (current.content) current.content += "\n" + line;
          else current.content = line;
        }
      });
      if (current) newData.push(current);

      if (!newData.length) {
        alert("형식에 맞는 [Day] 블록을 찾지 못했습니다.");
        return;
      }

      scheduleData = newData;
      currentDayId = scheduleData[0].id;
      renderDayTabs();
      updateDayContent();
      saveSchedule();
      alert("텍스트에서 일정을 불러왔습니다.");
    }

    exportTextBtn.addEventListener("click", exportScheduleToText);
    importTextBtn.addEventListener("click", importScheduleFromText);

    // 일정 데이터 초기 로드
    loadSchedule();
    renderDayTabs();
    updateDayContent();

    // 시작 시 환율 한번 가져오기
    fetchRate();
    // 기본 선택 방식: 검색형
    setPickMode("search");
  </script>
</body>
</html>
