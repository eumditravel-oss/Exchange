<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í™˜ìœ¨, ì‹œì°¨, ì¼ì • ê³„ì‚°ê¸°</title>

  <!-- ëª¨ë°”ì¼ í™•ëŒ€ ë°©ì§€ & ë°˜ì‘í˜• -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ì¹´ì¹´ì˜¤í†¡ / ë¯¸ë¦¬ë³´ê¸°ìš© ë©”íƒ€ -->
  <meta name="description" content="ê°„í¸í•˜ê²Œ í™˜ìœ¨, ì‹œì°¨, ì—¬í–‰ ì¼ì •ì„ í•œ ë²ˆì— ì •ë¦¬í•´ ë³´ì„¸ìš”." />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="í™˜ìœ¨, ì‹œì°¨, ì¼ì • ê³„ì‚°ê¸°" />
  <meta property="og:description" content="ê°„í¸í•˜ê²Œ í™˜ìœ¨,ì‹œì°¨ ê³„ì‚°ê³¼ ì—¬í–‰ ì¼ì • ì •ë¦¬ë¥¼ í•œ ë²ˆì—." />
  <meta property="og:url" content="https://eumditravel-oss.github.io/Exchange/" />
  <meta property="og:image" content="https://eumditravel-oss.github.io/Exchange/preview.png" />
  <meta property="og:locale" content="ko_KR" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="í™˜ìœ¨, ì‹œì°¨, ì¼ì • ê³„ì‚°ê¸°" />
  <meta name="twitter:description" content="ê°„í¸í•˜ê²Œ í™˜ìœ¨,ì‹œì°¨ ê³„ì‚°ê³¼ ì—¬í–‰ ì¼ì • ì •ë¦¬ë¥¼ í•œ ë²ˆì—." />
  <meta name="twitter:image" content="https://eumditravel-oss.github.io/Exchange/preview.png" />

  <style>
    :root {
      --panel-bg: rgba(255, 255, 255, 0.78);
      --panel-inner-bg: rgba(255, 255, 255, 0.9);
      --border: rgba(209, 213, 219, 0.8);
      --accent: #2563eb;
      --accent-soft: rgba(37, 99, 235, 0.12);
      --text: #111827;
      --muted: #4b5563;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 16px 8px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text);
      background:
        linear-gradient(to bottom, rgba(15, 23, 42, 0.25), rgba(15, 23, 42, 0.3)),
        url("plane-window.png") center/cover fixed no-repeat;
    }

    .app {
      max-width: 1040px;
      margin: 0 auto;
      padding: 18px 20px 14px;
      background: var(--panel-bg);
      border-radius: 22px;
      border: 1px solid rgba(255, 255, 255, 0.6);
      box-shadow:
        0 16px 38px rgba(15, 23, 42, 0.32),
        0 0 0 1px rgba(255, 255, 255, 0.15);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }

    header {
      position: relative;
      z-index: 1;
    }

    /* ì œëª© */
    h1 {
      font-size: 1.45rem;
      margin: 0 0 0.15rem;
      color: #111827;
    }

    @media (max-width: 720px) {
      h1 { font-size: 1.25rem; }
    }

    p.desc {
      margin: 0;
      color: #374151;
      font-size: 0.9rem;
    }

    /* ìƒë‹¨ íƒ­ */
    .top-bar {
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
    }

    .tabs {
      display: inline-flex;
      padding: 2px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.7);
      box-shadow: 0 1px 5px rgba(15, 23, 42, 0.18);
      gap: 4px;
    }

    .tab-button {
      border: none;
      background: transparent;
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 0.86rem;
      cursor: pointer;
      color: #6b7280;
      white-space: nowrap;
    }

    .tab-button.active {
      background: #111827;
      color: #f9fafb;
    }

    .view {
      margin-top: 12px;
    }

    .layout {
      position: relative;
      z-index: 1;
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
    }

    .panel {
      flex: 1 1 320px;
      min-width: 0;
      border-radius: 16px;
      border: 1px solid var(--border);
      padding: 14px 16px 16px;
      background: var(--panel-inner-bg);
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.18);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    /* íŒ¨ë„ ìƒë‹¨ : ì œëª© + ì„ íƒë°©ì‹ */
    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }

    .panel-header h2 {
      margin: 0;
      font-size: 1.05rem;
    }

    label {
      display: block;
      margin-top: 0.9rem;
      font-weight: 600;
      font-size: 0.88rem;
    }

    input, select, textarea {
      width: 100%;
      padding: 7px 9px;
      margin-top: 0.35rem;
      border: 1px solid rgba(148, 163, 184, 0.9);
      border-radius: 8px;
      font-size: 0.9rem;
      background: rgba(255, 255, 255, 0.92);
    }

    /* iPhoneì—ì„œ input í´ë¦­ ì‹œ í™•ëŒ€ ë°©ì§€ */
    @media (max-width: 720px) {
      input, select, textarea {
        font-size: 16px !important;
      }
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
    }

    .help {
      font-size: 0.78rem;
      color: var(--muted);
      margin-top: 0.15rem;
    }

    .small-label {
      margin-top: 0.35rem;
      font-size: 0.78rem;
      color: var(--muted);
    }

    .suggestions {
      position: relative;
    }

    .suggestions-list {
      position: absolute;
      z-index: 10;
      top: 100%;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.98);
      border: 1px solid rgba(209, 213, 219, 0.9);
      border-top: none;
      max-height: 200px;
      overflow-y: auto;
      font-size: 0.82rem;
      border-radius: 0 0 8px 8px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.35);
    }

    .suggestion-item {
      padding: 6px 9px;
      cursor: pointer;
    }

    .suggestion-item:hover {
      background: var(--accent-soft);
    }

    .rate-info {
      margin-top: 0.45rem;
      font-size: 0.78rem;
      color: var(--muted);
    }

    .error {
      margin-top: 0.5rem;
      color: #b91c1c;
      font-size: 0.8rem;
    }

    .ok {
      margin-top: 0.45rem;
      color: #2563eb;
      font-size: 0.8rem;
    }

    .calc-summary {
      margin-top: 0.7rem;
      font-size: 0.9rem;
    }

    .calc-summary div {
      margin-top: 0.25rem;
    }

    .calc-main {
      font-weight: 600;
    }

    .section-divider {
      margin-top: 0.9rem;
      padding-top: 0.7rem;
      border-top: 1px dashed rgba(148, 163, 184, 0.8);
    }

    .sub-heading {
      margin: 0 0 0.3rem;
      font-size: 0.9rem;
      font-weight: 600;
    }

    footer {
      position: relative;
      z-index: 1;
      margin-top: 12px;
      font-size: 0.78rem;
      color: #e5e7eb;
      text-align: center;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.35);
    }

    footer a {
      color: #bfdbfe;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* PC/ëª¨ë°”ì¼ ì„¤ëª… ë¶„ë¦¬ */
    .only-desktop { display: block; }
    .only-mobile  { display: none; }

    @media (max-width: 720px) {
      .panel { flex: 1 1 100%; }
      .top-bar { justify-content: flex-start; }
      .tab-button {
        padding: 4px 10px;
        font-size: 0.8rem;
      }
      .only-desktop { display: none; }
      .only-mobile  { display: block; }
    }

    /* í†µí™”/êµ­ê°€ ì„ íƒ ë°©ì‹ í† ê¸€ â€“ íŒ¨ë„ ìš°ì¸¡ ìƒë‹¨ */
    .mode-toggle {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 1px 4px rgba(15, 23, 42, 0.12);
      font-size: 0.78rem;
      color: #4b5563;
      white-space: nowrap;
    }

    .mode-label {
      font-weight: 500;
      font-size: 0.78rem;
    }

    .mode-btn {
      border: none;
      background: transparent;
      padding: 4px 9px;
      border-radius: 999px;
      font-size: 0.78rem;
      cursor: pointer;
      color: #6b7280;
      white-space: nowrap;
    }

    .mode-btn.active {
      background: #111827;
      color: #f9fafb;
    }

    @media (max-width: 720px) {
      .mode-toggle {
        font-size: 0.7rem;
        padding: 2px 6px;
        gap: 4px;
      }
      .mode-label {
        font-size: 0.7rem;
      }
      .mode-btn {
        padding: 3px 6px;
        font-size: 0.7rem;
      }
    }

    /* ì„ íƒ ë°©ì‹ì— ë”°ë¥¸ í‘œì‹œ ì œì–´ */
    body[data-pick-mode="search"] .select-mode { display: none; }
    body[data-pick-mode="search"] .search-mode { display: block; }

    body[data-pick-mode="select"] .select-mode { display: block; }
    body[data-pick-mode="select"] .search-mode { display: none; }

    /* í•©ì‚°ì‹ + / - í‚¤íŒ¨ë“œ */
    .calc-keypad-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 6px;
      font-size: 0.78rem;
    }

    .calc-keypad {
      display: inline-flex;
      gap: 6px;
    }

    .calc-key {
      min-width: 32px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: #f9fafb;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .calc-key:active { background: #e5e7eb; }

    .calc-hint {
      color: var(--muted);
      white-space: nowrap;
    }

    /* ===== ì¼ì • ê´€ë¦¬ íƒ­ ===== */
    .schedule-header-text {
      margin-top: 0.2rem;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .day-toolbar {
      margin-top: 0.85rem;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .day-toolbar button,
    .schedule-export-btn,
    .schedule-import-btn {
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: #f9fafb;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .day-tabs {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .day-tab-btn {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: #ffffff;
      font-size: 0.78rem;
      cursor: pointer;
    }

    .day-tab-btn.active {
      background: #111827;
      color: #f9fafb;
      border-color: #111827;
    }

    /* ì¼ì • í…Œì´ë¸” */
    .schedule-table-header {
      display: grid;
      grid-template-columns: 70px minmax(120px, 2fr) minmax(120px, 2fr) 64px;
      gap: 6px;
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 12px;
      align-items: center;
    }

    .schedule-rows {
      margin-top: 6px;
    }

    .schedule-row {
      display: grid;
      grid-template-columns: 70px minmax(120px, 2fr) minmax(120px, 2fr) 64px;
      gap: 6px;
      margin-top: 6px;
      align-items: stretch;
    }

    .schedule-row input {
      width: 100%;
      padding: 6px 7px;
      font-size: 0.82rem;
      border: 1px solid rgba(148, 163, 184, 0.9);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.92);
      box-sizing: border-box;
    }

    .schedule-textarea {
      width: 100%;
      padding: 6px 7px;
      font-size: 0.82rem;
      border: 1px solid rgba(148, 163, 184, 0.9);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.92);
      box-sizing: border-box;
      resize: vertical;
      min-height: 32px;
      line-height: 1.3;
      overflow-wrap: break-word;
      word-break: break-word;
    }

    /* êµ¬ê¸€ë§µ ë²„íŠ¼ (í•€ ì•„ì´ì½˜) â€“ í…Œë‘ë¦¬ ì œê±° & ì•ˆìœ¼ë¡œ ì •ë ¬ */
    .map-btn {
      width: 100%;
      padding: 0;
      height: 32px;
      border-radius: 8px;
      border: none;              /* âœ… í…Œë‘ë¦¬ ì œê±° */
      background: transparent;   /* âœ… ë°°ê²½ íˆ¬ëª… */
      font-size: 1.2rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .map-btn:active {
      transform: scale(0.95);
    }

    .add-row-btn {
      margin-top: 8px;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px dashed rgba(148, 163, 184, 0.9);
      background: #f9fafb;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .schedule-footer {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      font-size: 0.78rem;
      color: var(--muted);
    }

    .schedule-footer-note {
      margin-top: 8px;
      font-size: 0.78rem;
      color: var(--muted);
    }

    .schedule-export-area {
      margin-top: 8px;
      width: 100%;
      min-height: 80px;
      font-size: 0.8rem;
    }

    /* ë‚ ì”¨ ë°•ìŠ¤ */
    .weather-box {
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: rgba(239, 246, 255, 0.9);
      font-size: 0.8rem;
      color: #1f2937;
      line-height: 1.4;
    }

    .weather-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .weather-small {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 2px;
    }

    @media (max-width: 720px) {
      .schedule-table-header,
      .schedule-row {
        grid-template-columns: 60px minmax(100px, 2fr) minmax(100px, 2fr) 56px;
      }
    }
  </style>
</head>

<body data-pick-mode="search">
  <div class="app">
    <header>
      <h1>í™˜ìœ¨, ì‹œì°¨, ì¼ì • ê³„ì‚°ê¸°</h1>
      <p class="desc">ì—¬í–‰Â·ì†¡ê¸ˆ ì „ì— í™˜ìœ¨, ì‹œì°¨, ì¼ì •ê¹Œì§€ í•œ ë²ˆì— ì •ë¦¬í•˜ê¸°.</p>

      <div class="top-bar">
        <div class="tabs">
          <button class="tab-button active" data-view="exchange">í™˜ìœ¨ ê³„ì‚°</button>
          <button class="tab-button" data-view="time">ì‹œì°¨ ê²€ìƒ‰</button>
          <button class="tab-button" data-view="schedule">ì¼ì • ê´€ë¦¬</button>
        </div>
      </div>
    </header>
    
    <!-- ===== ì¼ì • ê´€ë¦¬ ë·° ===== -->
<div class="view view-schedule" style="display:none;">
  <div class="layout">
    <section class="panel">

      <div class="panel-header">
        <h2>ì¼ì • ê´€ë¦¬</h2>
      </div>

      <p class="schedule-header-text">
        ì—¬í–‰ íƒ€ì´í‹€ì„ ì…ë ¥í•˜ê³  Day ë‹¨ìœ„ë¡œ ì‹œê°„ / ì¥ì†Œ / ë©”ëª¨ë¥¼ ì •ë¦¬í•˜ì„¸ìš”.<br>
        ê° í–‰ì˜ <b>ğŸ“ í•€ ì•„ì´ì½˜</b>ì„ ëˆ„ë¥´ë©´ êµ¬ê¸€ë§µ ìë™ ê²€ìƒ‰ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.
      </p>

      <!-- ì—¬í–‰ íƒ€ì´í‹€ -->
      <label for="tripTitle">ì—¬í–‰ íƒ€ì´í‹€ / ë°©ë¬¸ êµ­ê°€</label>
      <input id="tripTitle" type="text" placeholder="ì˜ˆ: í™ì½© ì—¬í–‰, ì˜¤ì‚¬ì¹´ ì—¬í–‰" />

      <!-- Day ì¡°ì‘ ë²„íŠ¼ -->
      <div class="day-toolbar">
        <button type="button" id="addDayBtn">Day ì¶”ê°€</button>
        <button type="button" id="deleteDayBtn">í˜„ì¬ Day ì‚­ì œ</button>
        <button type="button" id="renameDayBtn">í˜„ì¬ Day ì´ë¦„ ë³€ê²½</button>
      </div>

      <!-- Day íƒ­ -->
      <div class="day-tabs" id="dayTabs"></div>

      <!-- ì¼ì • í…Œì´ë¸” í—¤ë” -->
      <div class="schedule-table-header">
        <div>ì‹œê°„</div>
        <div>ì§€ëª…</div>
        <div>ë¹„ê³ </div>
        <div style="text-align:center;">ğŸ“</div>
      </div>

      <!-- ì¼ì • í–‰ ì¶œë ¥ ì˜ì—­ -->
      <div class="schedule-rows" id="scheduleRows"></div>

      <!-- ì¼ì • ì¶”ê°€ ë²„íŠ¼ -->
      <button type="button" class="add-row-btn" id="addRowBtn">+ ì¼ì • ì¶”ê°€</button>

      <!-- ë‚´ë³´ë‚´ê¸° / ë¶ˆëŸ¬ì˜¤ê¸° -->
      <div class="schedule-footer">
        <button type="button" class="schedule-export-btn" id="exportBtn">í…ìŠ¤íŠ¸ë¡œ ë‚´ë³´ë‚´ê¸°</button>
        <button type="button" class="schedule-import-btn" id="importBtn">í…ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°</button>
      </div>

      <textarea
        id="exportTextArea"
        class="schedule-export-area"
        placeholder="[Title] í™ì½© ì—¬í–‰
[Day.1]
09:00 | ì¹¨ì‚¬ì¶”ì´ ìŠ¤íƒ€ì˜ ê±°ë¦¬ | ì•¼ê²½ ê°ìƒ"
      ></textarea>

      <p class="schedule-footer-note">
        â€» txt íŒŒì¼ë¡œ ì €ì¥í•´ ë‘ì—ˆë‹¤ê°€ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ë©´ ê·¸ëŒ€ë¡œ ì¼ì • ë³µì› ê°€ëŠ¥í•©ë‹ˆë‹¤.
      </p>

      <!-- ë¶ˆëŸ¬ì˜¤ê¸° hidden file input -->
      <input type="file" id="importFileInput" accept=".txt" style="display:none;" />
    </section>
  </div>
</div>

<!-- ===== ì—¬í–‰ íƒ€ì´í‹€ ê¸°ë°˜ ë‚ ì”¨ ì •ë³´ ë°•ìŠ¤ ===== -->
<div id="weatherBox" style="
  margin-top:14px;
  padding:12px;
  background:rgba(255,255,255,0.65);
  border-radius:12px;
  display:none;
  font-size:0.9rem;
  line-height:1.4;
">
  <b id="weatherTitle"></b><br>
  ì˜¤ëŠ˜: <span id="weatherToday"></span><br>
  ë‚´ì¼: <span id="weatherTomorrow"></span>
</div>

<style>
/* ===== ì¼ì • ê´€ë¦¬ ìŠ¤íƒ€ì¼ ===== */

.schedule-header-text {
  margin-top: 0.2rem;
  font-size: 0.8rem;
  color: var(--muted);
}

/* Day ë²„íŠ¼ */
.day-toolbar button {
  padding: 5px 10px;
  border-radius: 999px;
  border: 1px solid rgba(148,163,184,0.9);
  background: #f9fafb;
  font-size: 0.8rem;
  cursor: pointer;
}

/* Day íƒ­ */
.day-tab-btn {
  padding: 4px 10px;
  border-radius: 999px;
  border: 1px solid rgba(148,163,184,0.9);
  background: #fff;
  font-size: 0.78rem;
  cursor: pointer;
}
.day-tab-btn.active {
  background:#111827;
  color:#fff;
}

/* í…Œì´ë¸” í˜•íƒœ */
.schedule-table-header,
.schedule-row {
  display: grid;
  grid-template-columns: 70px minmax(140px,2fr) minmax(140px,2fr) 48px;
  gap: 6px;
  align-items: center;
  margin-top: 8px;
}

@media (max-width:720px) {
  .schedule-table-header,
  .schedule-row {
    grid-template-columns: 60px minmax(110px,2fr) minmax(110px,2fr) 44px;
  }
}

/* í–‰ ë‚´ë¶€ input */
.schedule-row input {
  width: 100%;
  padding: 6px 7px;
  font-size: 0.82rem;
  border: 1px solid rgba(148,163,184,0.9);
  border-radius: 8px;
  background: rgba(255,255,255,0.92);
}

/* ì§€ëª…/ë¹„ê³ ëŠ” ìë™ ì¤„ë°”ê¿ˆ */
.schedule-textarea {
  width: 100%;
  padding: 6px 7px;
  font-size: 0.82rem;
  border-radius: 8px;
  border: 1px solid rgba(148,163,184,0.9);
  resize: vertical;
  background: rgba(255,255,255,0.92);
  white-space: pre-wrap;
  min-height: 34px;
  line-height: 1.35;
}

/* ğŸ“ Google Maps ë²„íŠ¼ */
.map-btn {
  width: 100%;
  height: 34px;
  font-size: 1.25rem;
  border: none;
  background: transparent;
  cursor: pointer;
  text-align:center;
  padding: 0;
  margin: 0;
}

/* ëª¨ë°”ì¼ì—ì„œ íŠ€ì–´ë‚˜ì˜¤ì§€ ì•Šë„ë¡ ì¤‘ì•™ ì •ë ¬ ê³ ì • */
.schedule-row > .map-btn {
  justify-self: center;
}
</style>

<script>
// =========================
//        ê³µí†µ íƒ­ ì „í™˜
// =========================
const tabButtons = document.querySelectorAll(".tab-button");
const views = document.querySelectorAll(".view");

tabButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    tabButtons.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    const viewName = btn.dataset.view;
    views.forEach(v => {
      v.style.display = v.classList.contains(`view-${viewName}`) ? "block" : "none";
    });
  });
});


// =========================
//      í™˜ìœ¨ ê³„ì‚° ê¸°ëŠ¥
// =========================
let currencyMode = "search"; // search / dropdown

document.getElementById("modeSearchBtn").onclick = () => {
  currencyMode = "search";
  document.getElementById("modeSearchBtn").classList.add("active");
  document.getElementById("modeDropdownBtn").classList.remove("active");
  document.querySelector(".currency-search-box").style.display = "block";
  document.querySelector(".currency-dropdown-box").style.display = "none";
};

document.getElementById("modeDropdownBtn").onclick = () => {
  currencyMode = "dropdown";
  document.getElementById("modeDropdownBtn").classList.add("active");
  document.getElementById("modeSearchBtn").classList.remove("active");
  document.querySelector(".currency-search-box").style.display = "none";
  document.querySelector(".currency-dropdown-box").style.display = "block";
};

// í™˜ìœ¨ API í˜¸ì¶œ
async function fetchRate(base, target) {
  try {
    const url = `https://open.er-api.com/v6/latest/${base}`;
    const res = await fetch(url);
    const data = await res.json();
    return data.rates[target];
  } catch (e) {
    return null;
  }
}

// í…ìŠ¤íŠ¸ í•©ì‚°ì‹ ê³„ì‚° + í™˜ì „ ì ìš©
async function convertTotal() {
  const raw = document.getElementById("sumInput").value;
  let base = document.getElementById("baseCurrency").value;
  let target = document.getElementById("targetCurrency").value;

  // í•©ì‚° ê°’ ê³„ì‚°
  let total = 0;
  try {
    total = Function(`return ${raw.replace(/[^0-9+\-*/().]/g, "")}`)();
  } catch {
    total = 0;
  }

  document.getElementById("sumResult").textContent = `${total.toLocaleString()}`;

  // í™˜ìœ¨ ì ìš©
  const rate = await fetchRate(base, target);
  if (!rate) {
    document.getElementById("exchangeResult").textContent = "í™˜ìœ¨ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜";
    return;
  }

  const converted = total * rate;
  document.getElementById("exchangeResult").textContent =
    `${converted.toLocaleString(undefined,{maximumFractionDigits:2})} ${target}`;
}

document.getElementById("sumInput").addEventListener("input", convertTotal);


// =========================
//      ì‹œì°¨ ê³„ì‚° ê¸°ëŠ¥
// =========================
async function fetchTimeDiff(country) {
  try {
    const url = `https://worldtimeapi.org/api/timezone`;
    const all = await fetch(url);
    const zones = await all.json();
    
    const match = zones.find(z => z.toLowerCase().includes(country.toLowerCase()));
    if (!match) return null;

    const info = await fetch(`https://worldtimeapi.org/api/timezone/${match}`);
    const data = await info.json();
    return data;
  } catch {
    return null;
  }
}

document.getElementById("timeSearchBtn").onclick = async () => {
  const country = document.getElementById("timeSearchInput").value.trim();
  const box = document.getElementById("timeResultBox");

  const data = await fetchTimeDiff(country);
  if (!data) {
    box.textContent = "í•´ë‹¹ êµ­ê°€ì˜ ì‹œì°¨ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
    return;
  }

  box.innerHTML = `
    <b>${country}</b><br>
    í˜„ì¬ì‹œê°: ${data.datetime.slice(11,16)}<br>
    UTC ì˜¤í”„ì…‹: ${data.utc_offset}
  `;
};


// =========================
//      ì¼ì • ê´€ë¦¬ ê¸°ëŠ¥
// =========================
let days = []; // { name: "Day.1", rows: [] }
let currentDayIndex = -1;

const dayTabs = document.getElementById("dayTabs");
const scheduleRows = document.getElementById("scheduleRows");

// Day ì¶”ê°€
document.getElementById("addDayBtn").onclick = () => {
  const dayName = `Day.${days.length + 1}`;
  days.push({ name: dayName, rows: [] });
  currentDayIndex = days.length - 1;
  renderDayTabs();
  renderRows();
};

// Day ì‚­ì œ
document.getElementById("deleteDayBtn").onclick = () => {
  if (currentDayIndex < 0) return;
  days.splice(currentDayIndex, 1);
  if (days.length === 0) currentDayIndex = -1;
  else currentDayIndex = 0;
  renderDayTabs();
  renderRows();
};

// Day ì´ë¦„ ë³€ê²½
document.getElementById("renameDayBtn").onclick = () => {
  if (currentDayIndex < 0) return;
  const newName = prompt("ìƒˆ Day ì´ë¦„ ì…ë ¥", days[currentDayIndex].name);
  if (!newName) return;
  days[currentDayIndex].name = newName;
  renderDayTabs();
};

// Day íƒ­ ë Œë”ë§
function renderDayTabs() {
  dayTabs.innerHTML = "";
  days.forEach((d, i) => {
    const btn = document.createElement("button");
    btn.className = "day-tab-btn" + (i === currentDayIndex ? " active" : "");
    btn.textContent = d.name;
    btn.onclick = () => {
      currentDayIndex = i;
      renderDayTabs();
      renderRows();
    };
    dayTabs.appendChild(btn);
  });
}

// ì¼ì • í–‰ ë Œë”
function renderRows() {
  scheduleRows.innerHTML = "";
  if (currentDayIndex < 0) return;
  
  days[currentDayIndex].rows.forEach((row, idx) => {
    const div = document.createElement("div");
    div.className = "schedule-row";

    div.innerHTML = `
      <input type="text" placeholder="09:00" value="${row.time || ""}"
        onchange="updateRow(${idx}, 'time', this.value)">
      <textarea class="schedule-textarea" placeholder="ì§€ëª…"
        onchange="updateRow(${idx}, 'place', this.value)">${row.place || ""}</textarea>
      <textarea class="schedule-textarea" placeholder="ë¹„ê³ "
        onchange="updateRow(${idx}, 'memo', this.value)">${row.memo || ""}</textarea>

      <button class="map-btn" onclick="openGoogleMap(${idx})">ğŸ“</button>
    `;
    scheduleRows.appendChild(div);
  });
}

// í–‰ ë°ì´í„° ì—…ë°ì´íŠ¸
function updateRow(index, field, value) {
  days[currentDayIndex].rows[index][field] = value;
}

// ì¼ì • ì¶”ê°€
document.getElementById("addRowBtn").onclick = () => {
  if (currentDayIndex < 0) return;
  days[currentDayIndex].rows.push({ time: "", place: "", memo: "" });
  renderRows();
};

// ì§€ë„ ê²€ìƒ‰
function openGoogleMap(idx) {
  const country = document.getElementById("tripTitle").value.trim();
  const row = days[currentDayIndex].rows[idx];
  const q = encodeURIComponent(`${country} ${row.place}`);
  window.open(`https://www.google.com/maps/search/?api=1&query=${q}`, "_blank");
}


// =========================
//   ì¼ì • í…ìŠ¤íŠ¸ ë‚´ë³´ë‚´ê¸°
// =========================
document.getElementById("exportBtn").onclick = () => {
  let txt = `[Title] ${document.getElementById("tripTitle").value}\n\n`;

  days.forEach(d => {
    txt += `[${d.name}]\n`;
    d.rows.forEach(r => {
      txt += `${r.time} | ${r.place} | ${r.memo}\n`;
    });
    txt += `\n`;
  });

  const blob = new Blob([txt], { type: "text/plain" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "travel_plan.txt";
  a.click();

  URL.revokeObjectURL(url);
};

document.getElementById("importBtn").onclick = () => {
  document.getElementById("importFileInput").click();
};

// =========================
//    í…ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
// =========================
document.getElementById("importFileInput").addEventListener("change", async (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const text = await file.text();
  const lines = text.split("\n");

  days = [];
  currentDayIndex = -1;

  let currentDay = null;

  lines.forEach(line => {
    if (line.startsWith("[Title]")) {
      document.getElementById("tripTitle").value = line.replace("[Title]", "").trim();
    } 
    else if (line.startsWith("[Day")) {
      currentDay = { name: line.replace("[", "").replace("]", ""), rows: [] };
      days.push(currentDay);
      currentDayIndex = days.length - 1;
    }
    else if (line.includes("|")) {
      const [time, place, memo] = line.split("|").map(s => s.trim());
      currentDay.rows.push({ time, place, memo });
    }
  });

  renderDayTabs();
  renderRows();
});
</script>